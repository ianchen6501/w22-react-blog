(this.webpackJsonptest=this.webpackJsonptest||[]).push([[0],{29:function(t,n,e){},36:function(t,n,e){"use strict";e.r(n);var r=e(1),c=e(0),o=e(20),i=e.n(o),a=(e(29),e(10)),u=e(5),s=e(4),j=e(9),b=e(2),d="token",l=function(t){localStorage.setItem(d,t)},f="https://student-json-api.lidemy.me",O=function(){var t=localStorage.getItem(d);return fetch("".concat(f,"/me"),{headers:{authorization:"Bearer ".concat(t)}}).then((function(t){return t.json()}))};function h(){var t=Object(u.a)(["\n  color: rgba(0, 0, 0, 0.8);\n"]);return h=function(){return t},t}function x(){var t=Object(u.a)(["\n  font-size: 24px;\n  text-decoration: none;\n  color: #333;\n"]);return x=function(){return t},t}function p(){var t=Object(u.a)(["\n  border-bottom: 1px solid rgba(0, 12, 34, 0.2);\n  padding: 16px;\n  display: flex;\n  align-items: flex-end;\n  justify-content: space-between;\n"]);return p=function(){return t},t}function v(){var t=Object(u.a)(["\n  width: 80%;\n  margin: 0 auto;\n"]);return v=function(){return t},t}var g=s.b.div(v()),m=s.b.div(p()),y=Object(s.b)(j.b)(x()),S=s.b.div(h());function k(t){var n=t.post;return Object(r.jsxs)(m,{children:[Object(r.jsx)(y,{to:"/posts/".concat(n.id),children:n.title}),Object(r.jsx)(S,{children:new Date(n.createdAt).toLocaleDateString()})]})}function w(){var t=Object(c.useState)([]),n=Object(a.a)(t,2),e=n[0],o=n[1];return Object(c.useEffect)((function(){fetch("".concat(f,"/posts?_sort=createdAt&_order=dest")).then((function(t){return t.json()})).then((function(t){return o(t)}))})),Object(r.jsx)(g,{children:e.map((function(t){return Object(r.jsx)(k,{post:t},t.id)}))})}var C=Object(c.createContext)(null);function _(){var t=Object(u.a)(["\n  color: red;\n"]);return _=function(){return t},t}var z=s.b.div(_());function I(){var t=Object(c.useContext)(C).setUser,n=Object(c.useState)(""),e=Object(a.a)(n,2),o=e[0],i=e[1],u=Object(c.useState)(""),s=Object(a.a)(u,2),j=s[0],d=s[1],h=Object(c.useState)(""),x=Object(a.a)(h,2),p=x[0],v=x[1],g=Object(b.f)();return Object(r.jsxs)("form",{onSubmit:function(n){v(null),n.preventDefault(),function(t,n){return fetch("".concat(f,"/login"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:t,password:n})}).then((function(t){return t.json()}))}(o,j).then((function(n){if(0===n.ok)return v(n.message);l(n.token),O().then((function(n){if(1!==n.ok)return l(null),v(n.toString());t(n.data),g.push("/")}))}))},children:[Object(r.jsxs)("div",{children:["username:"," ",Object(r.jsx)("input",{type:"text",value:o,onChange:function(t){return i(t.target.value)}})]}),Object(r.jsxs)("div",{children:["password:"," ",Object(r.jsx)("input",{type:"text",value:j,onChange:function(t){return d(t.target.value)}})]}),Object(r.jsx)("button",{children:"\u767b\u5165"}),p&&Object(r.jsx)(z,{children:p})]})}function $(){var t=Object(u.a)(["\n  display: flex;\n  align-items: center;\n\n  "," {\n    margin-left: 32px;\n  }\n"]);return $=function(){return t},t}function D(){var t=Object(u.a)([" \n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 64px;\n  box-sizing: border-box;\n  width: 100px;\n  cursor: pointer;\n  color: black;\n  text-decoration: none;\n\n  ","\n"]);return D=function(){return t},t}function E(){var t=Object(u.a)(["\n  display: flex;\n  align-items: center;\n"]);return E=function(){return t},t}function J(){var t=Object(u.a)(["\n  font-size: 32px;\n  font-weight: bold;\n"]);return J=function(){return t},t}function U(){var t=Object(u.a)(["\n  height: 64px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  right: 0;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  position: fixed;\n  border-bottom: solid 0.1px rgb(0,0,0,0.2);\n  padding: 0px, 30px\n  background: rgb(5,5,5,0.2)\n"]);return U=function(){return t},t}var A=s.b.div(U()),B=s.b.div(J()),P=s.b.div(E()),L=Object(s.b)(j.b)(D(),(function(t){return t.$active&&"background: rgb(0,0,0,0.2)"})),N=s.b.div($(),P);function T(){var t=Object(b.g)(),n=Object(b.f)(),e=Object(c.useContext)(C),o=e.user,i=e.setUser;return Object(r.jsxs)(A,{children:[Object(r.jsxs)(N,{children:[Object(r.jsx)(B,{children:"\u5c0f\u660e\u7684\u90e8\u843d\u683c"}),Object(r.jsxs)(P,{children:[Object(r.jsx)(L,{to:"/",$active:"/"===t.pathname,children:"\u9996\u9801"}),o&&Object(r.jsx)(L,{to:"/new-post",$active:"/new-post"===t.pathname,children:"\u767c\u5e03\u6587\u7ae0"})]})]}),Object(r.jsx)(P,{children:o?Object(r.jsx)(L,{onClick:function(){l(""),i(null),"/"!==t.pathname&&n.push("/")},children:"\u767b\u51fa"}):Object(r.jsx)(L,{to:"/login",$active:"/login"===t.pathname,children:"\u767b\u5165"})})]})}function q(){var t=Object(u.a)(["\n  padding-top: 64px;\n"]);return q=function(){return t},t}var F=s.b.div(q());function G(){var t=Object(c.useState)(null),n=Object(a.a)(t,2),e=n[0],o=n[1];return Object(c.useEffect)((function(){localStorage.getItem("token")&&O().then((function(t){t.ok&&o(t.data)}))}),[]),Object(r.jsx)(C.Provider,{value:{user:e,setUser:o},children:Object(r.jsx)(F,{children:Object(r.jsxs)(j.a,{children:[Object(r.jsx)(T,{}),Object(r.jsxs)(b.c,{children:[Object(r.jsx)(b.a,{exact:!0,path:"/",children:Object(r.jsx)(w,{})}),Object(r.jsx)(b.a,{exact:!0,path:"/login",children:Object(r.jsx)(I,{})})]})]})})})}i.a.render(Object(r.jsx)(s.a,{theme:{colors:{red_300:"#c02828",red_400:"#ffa7a7",red_500:"#ff4949"}},children:Object(r.jsx)(G,{})}),document.getElementById("root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.ab2ef41c.chunk.js.map